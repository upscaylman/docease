<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="FO Métaux - DocEase - Générateur de documents">
  <meta name="keywords" content="FO Métaux, syndicat, métallurgie, désignation">
  
  <title>DocEase - FO Métaux</title>
  
  <!-- External Libraries -->
  <!-- Tailwind CSS compilé localement (pour éviter Tracking Prevention) -->
  <link rel="stylesheet" href="assets/css/tailwind.css?v=1.0.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="shortcut icon" type="image/x-icon" href="https://www.fo-metaux.org/images/favicon.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- Mammoth.js pour prévisualisation Word (local pour éviter Tracking Prevention) -->
  <script src="assets/js/lib/mammoth.browser.min.js"></script>

  <!-- SortableJS pour drag & drop (local pour éviter Tracking Prevention) -->
  <script src="assets/js/lib/Sortable.min.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/base.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/animations.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/components.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/layout.css?v=1.0.0">
  
  <!-- Design System - Chargé en dernier pour permettre les overrides -->
  <!-- SUPPRIMÉ POUR UTILISER UNIQUEMENT TAILWIND -->
  
  <style>
    html {
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }
    
    body {
      margin: 0 !important;
      padding: 0 !important;
      background: #2f2f2f;
      background-size: 400% 400% !important;
      animation: gradient 15s ease infinite !important;
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }
    header {
      width: 100%;
      margin: 0;
      padding: 0;
      flex-shrink: 0;
      background: white !important;
    }
    @media (max-width: 767px) {
      :root {
        --header-height: 64px;
      }
    }
    .main-content {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0;
      overflow: hidden;
      position: relative;
      min-height: 0;
    }
    @media (max-width: 767px) {
      /* Le form-container prend toute la hauteur disponible sur mobile */
      .form-container {
        flex: 1 1 auto;
        min-height: 0;
        padding-bottom: 0;
      }
    }
    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
      }
      .form-container {
        padding: 2rem 3rem;
        max-width: 100%;
      }
    }
    @media (max-width: 767px) {
      .main-content {
        padding-bottom: 60px; /* Espace pour le volet collapsed */
      }
      .main-content:has(.templates-sidebar:not(.collapsed)) {
        padding-bottom: 0; /* Pas d'espace quand déplié car il est fixed */
      }
    }
    .form-wrapper {
      flex: 1 !important;
      display: grid !important;
      grid-template-rows: 1fr auto !important;
      width: 100%;
      min-width: 0;
      min-height: 0 !important;
      position: relative;
      overflow: hidden !important;
    }
    @media (min-width: 768px) {
      .form-wrapper {
        width: calc(100% - 240px);
        max-width: calc(100% - 240px);
        flex: 0 0 calc(100% - 240px);
      }
    }
    .form-container {
      overflow-y: auto;
      overflow-x: hidden;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      position: relative;
      min-height: 0;
    }
    @media (max-width: 767px) {
      /* Le form-container prend toute la hauteur disponible sur mobile */
      .form-container {
        min-height: 0;
        padding-bottom: 0;
      }
    }
    @media (min-width: 768px) {
      .form-container {
        padding: 2rem 3rem;
        max-width: 100%;
      }
    }
    @media (min-width: 1024px) {
      .form-container {
        padding: 2rem 3rem;
      }
    }
    @media (min-width: 1280px) {
      .form-container {
        padding: 2rem 4rem;
      }
    }
    .templates-sidebar {
      width: 100%;
      background: white;
      border-top: 1px solid #e5e7eb;
      overflow-y: hidden;
      overflow-x: hidden;
      padding: 0.75rem;
      flex-shrink: 0;
      box-shadow: 0 8px 32px #00000094, inset 0 0 0 1px #fff3;
      transition: max-height 300ms cubic-bezier(0.2, 0, 0, 1);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 40;
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        position: relative;
        bottom: auto;
        left: auto;
        right: auto;
        z-index: 1;
      }
    }
    .templates-sidebar.collapsed {
      max-height: 60px; /* Valeur par défaut, sera calculée dynamiquement en JS */
    }
    .templates-sidebar:not(.collapsed) {
      max-height: 70vh;
      overflow-y: auto;
    }
    .templates-sidebar-content {
      transition: opacity 200ms ease, transform 200ms ease;
    }
    .templates-sidebar.collapsed .templates-sidebar-content {
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      max-height: 0;
      overflow: hidden;
    }
    .templates-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 0.5rem 0;
      background: transparent;
      border: none;
      cursor: pointer;
      color: #1f2937;
      font-weight: 700;
      transition: color 200ms ease;
    }
    .templates-toggle-btn:hover {
      color: #2563eb;
    }
    .templates-toggle-btn .material-icons {
      transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
    }
    .templates-sidebar.collapsed .templates-toggle-btn .material-icons:last-child {
      transform: rotate(0deg);
    }
    .templates-sidebar:not(.collapsed) .templates-toggle-btn .material-icons:last-child {
      transform: rotate(180deg);
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        max-height: none !important;
      }
      .templates-sidebar.collapsed .templates-sidebar-content {
        opacity: 1;
        transform: none;
        pointer-events: auto;
        max-height: none;
        overflow: visible;
      }
      .templates-toggle-btn {
        display: none;
      }
      /* Header toujours visible en desktop */
      .templates-sidebar-header {
        display: block !important;
      }
    }
    /* Tooltip d'aide pour les templates */
    .templates-help-icon {
      position: relative;
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        width: 240px;
        min-width: 240px;
        max-width: 240px;
        border-top: none;
        border-left: 1px solid #e5e7eb;
        padding: 1.5rem 1rem;
        max-height: 100%;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        box-shadow: 0 8px 32px #00000094, inset 0 0 0 1px #fff3;
        flex-shrink: 0;
      }
    }
    .templates-sidebar::-webkit-scrollbar {
      width: 8px;
    }
    .templates-sidebar::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    .templates-sidebar::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    .templates-sidebar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    /* Carrousel mobile - Design Material Expressif façon Netflix */
    #templatesGallery {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      overflow-y: hidden;
      padding: 0.5rem 0.25rem;
      padding-bottom: 0.75rem;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(37, 99, 235, 0.3) transparent;
      scroll-behavior: smooth;
      scroll-snap-type: x proximity;
    }
    #templatesGallery::-webkit-scrollbar {
      height: 4px;
    }
    #templatesGallery::-webkit-scrollbar-track {
      background: transparent;
      border-radius: 2px;
    }
    #templatesGallery::-webkit-scrollbar-thumb {
      background: rgba(37, 99, 235, 0.3);
      border-radius: 2px;
      transition: background 0.3s ease;
    }
    #templatesGallery::-webkit-scrollbar-thumb:hover {
      background: rgba(37, 99, 235, 0.5);
    }
    .template-card {
      border: none;
      border-radius: 12px;
      padding: 0.25rem;
      cursor: pointer;
      transition: all 400ms cubic-bezier(0.2, 0, 0, 1);
      background: transparent;
      flex-shrink: 0;
      width: calc(33.333% - 0.33rem);
      min-width: 90px;
      scroll-snap-align: start;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @media (min-width: 768px) {
      #templatesGallery {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
        overflow-x: visible;
        overflow-y: visible;
        padding: 0;
        scroll-snap-type: none;
      }
      .template-card {
        width: 100%;
        padding: 0.75rem;
        flex-shrink: 1;
        min-width: auto;
      }
    }
    .template-thumbnail {
      width: 50%;
      /* height: 125px; */
      border-radius: 8px;
      margin: 0 auto 0.25rem;
      object-fit: cover;
      transition: transform 400ms cubic-bezier(0.2, 0, 0, 1), 
                  box-shadow 400ms cubic-bezier(0.2, 0, 0, 1),
                  border-color 400ms cubic-bezier(0.2, 0, 0, 1);
      display: block;
      border: 2px solid transparent;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15),
                  0 2px 4px rgba(0, 0, 0, 0.1);
    }
    @media (min-width: 768px) {
      .template-thumbnail {
        width: 80%;
        height: 80%;
        border-radius: 3px;
      }
    }
    .template-card:hover .template-thumbnail {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4),
                  0 4px 8px rgba(37, 99, 235, 0.2);
      border-color: #60a5fa;
    }
    .template-card:active .template-thumbnail {
      transform: scale(1.05) translateY(-2px);
    }
    .template-card.selected .template-thumbnail {
      border-color: #e04142;
      box-shadow: 0 0 0 1px #e04142, 
                  0 4px 8px rgba(183, 28, 28, 0.2), 
                  0 2px 4px rgba(183, 28, 28, 0.2);
      transform: translateY(-2px);
    }
    .template-card.selected .template-thumbnail .material-icons {
      color: white;
    }
    /* Texte sous les vignettes - Mobile */
    .template-card h3 {
      font-size: 0.7rem;
      line-height: 0.9rem;
      font-weight: 700;
      color: #1f2937;
      margin-top: 0.75rem;
      margin-bottom: 0.125rem;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      width: 100%;
    }
    .template-card p {
      display: none;
    }
    /* Texte sous les vignettes - Desktop */
    @media (min-width: 768px) {
      .template-card h3 {
        font-size: 1rem;
        line-height: 1.25rem;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        white-space: normal;
      }
      .template-card p {
        display: none;
      }
    }
    .tab-button-floating {
      background: transparent;
      color: #a9a9a9;
      border: none;
      cursor: pointer;
      position: relative;
      transition: all 300ms cubic-bezier(0.2, 0, 0, 1);
      overflow: hidden;
      height: auto;
      align-self: stretch;
      display: flex;
      align-items: center;
    }
    .tab-button-floating:hover {
      background: #f3f4f6;
    }
    .tab-button-floating.active {
      background: #ffecf8;
      color: #2a2a2a;
      border-radius: 2rem;
      height: 100%;
      align-self: stretch;
    }
    /* Conteneur des boutons flottants - alignement à gauche */
    .tab-buttons-container {
      display: flex;
      align-items: stretch;
      height: 100%;
      position: relative;
    }
    .tab-label-floating {
      max-width: 0;
      opacity: 0;
      overflow: hidden;
      transition: max-width 400ms cubic-bezier(0.2, 0, 0, 1),
                  opacity 300ms cubic-bezier(0.2, 0, 0, 1) 100ms,
                  margin-left 300ms cubic-bezier(0.2, 0, 0, 1);
      white-space: nowrap;
      display: inline-block;
      font-weight: 800;
    }
    .tab-button-floating.active .tab-label-floating {
      max-width: 150px;
      opacity: 1;
      margin-left: 0.5rem;
      transition: max-width 400ms cubic-bezier(0.2, 0, 0, 1),
                  opacity 300ms cubic-bezier(0.2, 0, 0, 1) 100ms,
                  margin-left 300ms cubic-bezier(0.2, 0, 0, 1);
    }
    .tab-button-floating:not(.active) .tab-label-floating {
      max-width: 0;
      opacity: 0;
      margin-left: 0;
      transition: max-width 300ms cubic-bezier(0.2, 0, 0, 1),
                  opacity 200ms cubic-bezier(0.2, 0, 0, 1),
                  margin-left 300ms cubic-bezier(0.2, 0, 0, 1);
    }
    .step-indicator-floating {
      background: #a9a9a9;
      color: white;
      transition: all 300ms cubic-bezier(0.2, 0, 0, 1);
      flex-shrink: 0;
      position: relative;
    }
    .step-indicator-floating.active {
      background: #2f2f2f;
      color: white;
      transform: scale(1.1);
      width: 2.5rem;
    }
    /* Styles mobile pour la barre d'action principale */
    @media (max-width: 767px) {
      /* Masquer les boutons de flèches sur mobile */
      #actionPrevBtn,
      #actionNextBtn {
        display: none !important;
      }
      /* Width réduite pour l'indicateur actif sur mobile */
      .step-indicator-floating.active {
        width: 1.25rem !important;
      }
      /* Cacher les labels de texte des pages sur mobile */
      .tab-label-floating {
        display: none !important;
        max-width: 0 !important;
        opacity: 0 !important;
        margin-left: 0 !important;
      }
      .tab-button-floating.active .tab-label-floating {
        display: none !important;
        max-width: 0 !important;
        opacity: 0 !important;
        margin-left: 0 !important;
      }
      /* Permettre aux numéros de page d'utiliser tout l'espace disponible */
      .tab-buttons-container {
        justify-content: space-evenly !important;
        width: 100% !important;
      }
      
      /* Animation de morphing uniquement sur mobile */
      .step-indicator-floating {
        transition: all 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .step-indicator-floating.active {
        animation: morphActiveMobile 500ms cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      @keyframes morphActiveMobile {
        0% {
          transform: scale(1) translateX(0);
          border-radius: 50%;
        }
        25% {
          transform: scale(1.3, 0.8) translateX(10px);
          border-radius: 50% 30% 50% 30%;
        }
        50% {
          transform: scale(0.9, 1.2) translateX(0);
          border-radius: 30% 50% 30% 50%;
        }
        75% {
          transform: scale(1.2, 0.9) translateX(-5px);
          border-radius: 50% 40% 50% 40%;
        }
        100% {
          transform: scale(1.1);
          border-radius: 50%;
        }
      }
    }
    /* Override Design System pour les boutons spécifiques */
    #clearAllDataBtn {
      color: #eb2f06 !important;
      background: transparent !important;
      box-shadow: none !important;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    #clearAllDataBtn:hover {
      background-color: #f8c29154 !important;
      color: #eb2f06 !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12) !important;
      border-radius: 1rem !important;
    }
    #fillTestDataFloating {
      color: #181a1c !important;
      background: transparent !important;
      box-shadow: none !important;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    #fillTestDataFloating:hover {
      background-color: #e5e7eb !important;
      color: #181a1c !important;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
      border-radius: 1rem !important;
    }
    #customizeFieldsBtn:hover {
      background: #5e6b7b !important;
    }

    #headerPreviewBtn:disabled,
    #headerDownloadBtn:disabled {
      opacity: 0.5 !important;
      pointer-events: none;
    }
    #headerPreviewBtn:disabled:hover {
      transform: none !important;
      background-color: #4a69bd !important;
    }
    #headerDownloadBtn:disabled:hover {
      transform: none !important;
    }
    /* Styles mobile pour les boutons du header */
    @media (max-width: 767px) {
      /* Bouton Prévisualiser - background transparent, icône #a84383 */
      #headerPreviewBtn {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
      }
      #headerPreviewBtn .material-icons {
        color: #a84383 !important;
      }
      #headerPreviewBtn:hover {
        background: rgba(168, 67, 131, 0.1) !important;
      }
      /* Bouton Télécharger - background transparent, icône #dd60b0 */
      #headerDownloadBtn {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
      }
      #headerDownloadBtn .material-icons {
        color: #dd60b0 !important;
      }
      #headerDownloadBtn:hover {
        background: rgba(221, 96, 176, 0.1) !important;
      }
      /* Bouton Partager - background transparent, icône #a64182 */
      #headerSendBtn {
        background: transparent !important;
        border: none !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
      }
      #headerSendBtn .material-icons {
        color: #a64182 !important;
      }
      #headerSendBtn:hover {
        background: rgba(166, 65, 130, 0.1) !important;
      }
    }
    /* Chips d'email du modal de partage - pas de hover */
    .share-email-chip {
      background-color: #e04142 !important;
    }
    .share-email-chip:hover {
      background-color: #e04142 !important;
    }
    .share-email-chip button:hover {
      color: white !important;
    }
    /* Placeholders et icônes des champs de formulaire */
    input::placeholder,
    textarea::placeholder,
    select::placeholder {
      color: #a9a9a9 !important;
      opacity: 1;
    }
    .relative .material-icons.text-gray-400 {
      color: #a9a9a9 !important;
    }
    /* Footer principal */
    .main-footer {
      width: 100%;
      max-width: 100%;
      background: #2a2a2a;
      border-top: 1px solid #a9a9a929;
      flex-shrink: 0;
      margin-left: 0;
      box-sizing: border-box;
      position: relative;
      left: 0;
      right: 0;
      z-index: 1;
      flex: 0 0 auto;
    }
    @media (max-width: 767px) {
      /* Masquer complètement le footer sur mobile */
      .main-footer {
        display: none !important;
      }
    }
    @media (min-width: 768px) {
      /* Afficher le footer en desktop */
      .main-footer {
        display: block !important;
      }
    }
    .divider-gradient {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
    }
    @media (min-width: 768px) {
      .main-footer .text-center.md\:text-left {
        text-align: left !important;
      }
      .main-footer .text-center.md\:text-left h3,
      .main-footer .text-center.md\:text-left p {
        text-align: left !important;
      }
    }
    /* Alignement du début du carré du logo avec le début du container du formulaire */
    header .container {
      max-width: 1450px !important;
      margin-left: auto !important;
      margin-right: auto !important;
      padding-left: 2rem !important;
      padding-right: 2rem !important;
    }
    /* Alignement du footer avec le container du formulaire */
    .main-footer .container {
      max-width: 1280px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 1rem; /* même que form-container mobile */
      padding-right: 1rem;
    }
    .main-footer .container p {
      max-width: 100%;
      width: 100%;
    }
    @media (min-width: 768px) {
      .main-footer .container {
        padding-left: 3rem; /* même que form-container md: 2rem 3rem */
        padding-right: 3rem;
      }
    }
    @media (min-width: 1024px) {
      .main-footer .container {
        padding-left: 4rem; /* même que form-container lg: 3rem 4rem */
        padding-right: 4rem;
      }
    }
    @media (min-width: 1280px) {
      .main-footer .container {
        padding-left: 5rem; /* même que form-container xl: 3rem 5rem */
        padding-right: 5rem;
      }
    }
    /* Chips d'email du modal de partage - pas de hover */
    .share-email-chip {
      background-color: #e04142 !important;
    }
    .share-email-chip:hover {
      background-color: #e04142 !important;
    }
    .share-email-chip button:hover {
      color: white !important;
    }
    
    /* Modale de partage - Adaptation mobile */
    @media (max-width: 767px) {
      /* Margin bottom sur le form en mobile */
      #docForm {
        margin-bottom: 1rem !important;
      }
      
      #shareModal {
        padding: 0.5rem !important;
      }
      #shareModal > div {
        max-width: 100% !important;
        max-height: calc(100vh - 1rem) !important;
        margin: 0 !important;
        width: calc(100vw - 1rem) !important;
      }
      #shareModal .p-6 {
        padding: 1rem !important;
      }
      #shareModal h2 {
        font-size: 1.25rem !important;
      }
      #shareModal .material-icons:not(.text-base) {
        font-size: 32px !important;
      }
      
      /* Tous les boutons des modales en mode mobile - Style comme header */
      /* Bouton Prévisualiser dans modal (#headerPreviewBtn est dans le header mais on l'inclut ici pour cohérence) */
      
      /* Bouton Télécharger (#downloadWordBtn) - Modale de prévisualisation */
      #downloadWordBtn {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border: none !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #downloadWordBtn .material-icons {
        color: #dd60b0 !important;
        font-size: 20px !important;
      }
      #downloadWordBtn:hover {
        background: rgba(221, 96, 176, 0.1) !important;
      }
      
      /* Bouton Partager (#sendEmailBtn) - Modale de prévisualisation */
      #sendEmailBtn {
        background: transparent !important;
        border: none !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #sendEmailBtn .material-icons {
        color: #a64182 !important;
        font-size: 20px !important;
      }
      #sendEmailBtn:hover {
        background: rgba(166, 65, 130, 0.1) !important;
      }
      
      /* Bouton Générer et envoyer (#confirmShareBtn) - Modale de partage */
      #confirmShareBtn {
        background: transparent !important;
        border: none !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #confirmShareBtn .material-icons {
        color: #a64182 !important;
        font-size: 20px !important;
      }
      #confirmShareBtn:hover {
        background: rgba(166, 65, 130, 0.1) !important;
      }
      
      /* Bouton Fermer (#closeWordViewerBtn) - Modale Word Viewer */
      #closeWordViewerBtn {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #closeWordViewerBtn .material-icons {
        color: #36434e !important;
        font-size: 20px !important;
      }
      #closeWordViewerBtn:hover {
        background: rgba(54, 67, 78, 0.1) !important;
      }
      
      /* Bouton Fermer (#closeModal) - Modale de prévisualisation */
      #closeModal {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #closeModal .material-icons {
        color: #36434e !important;
        font-size: 20px !important;
      }
      #closeModal:hover {
        background: rgba(54, 67, 78, 0.1) !important;
      }
      
      /* Bouton Fermer (#closeShareModal) - Modale de partage */
      #closeShareModal {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #closeShareModal .material-icons {
        color: #36434e !important;
        font-size: 20px !important;
      }
      #closeShareModal:hover {
        background: rgba(54, 67, 78, 0.1) !important;
      }
      
      /* Bouton Fermer (#closeWordViewer) - Modale Word Viewer header */
      #closeWordViewer {
        background: transparent !important;
        padding: 0.5rem !important;
        min-width: 44px !important;
        min-height: 44px !important;
        border-radius: 9999px !important; /* rounded-full */
      }
      #closeWordViewer .material-icons {
        color: white !important;
        font-size: 20px !important;
      }
      #closeWordViewer:hover {
        background: rgba(255, 255, 255, 0.2) !important;
      }
      
      /* Masquer les textes des boutons en mobile, garder seulement les icônes */
      #downloadWordBtn span:not(.material-icons),
      #sendEmailBtn span:not(.material-icons),
      #confirmShareBtn span:not(.material-icons),
      #closeWordViewerBtn span:not(.material-icons) {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="glass-effect-strong border-b border-outlineVariant/50 sticky top-0 z-40 animate-slide-down backdrop-blur-xl">
    <div class="container mx-auto">
      <div class="flex items-center justify-between h-16 sm:h-18">
        <!-- Logo et Titre -->
        <div class="flex items-center space-x-6 cursor-pointer transition-opacity hover:opacity-80">
          <div class="p-2 rounded-lg flex items-center justify-center h-10 w-10 elevation-2 progressive-glow-quinary transition-transform hover:scale-110" style="background: #aa4584;">
            <span class="material-icons text-white" style="font-size: 24px;">description</span>
          </div>
          <!-- Logo texte -->
          <div style="margin-left: 0.8rem;">
            <span class="text-xl font-bold whitespace-nowrap">
              <span style="color: #aa4584;">DocEase</span>
              <span class="hidden sm:inline" style="color: #181a1c;"> by FO Metaux</span>
            </span>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <!-- Bouton Prévisualiser -->
          <button 
            type="button" 
            id="headerPreviewBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium text-white elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #a84383;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">visibility</span>
            <span class="hidden sm:inline">Prévisualiser</span>
          </button>

          <!-- Bouton Télécharger -->
          <button 
            type="button" 
            id="headerDownloadBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium text-white elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #dd60b0;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">download</span>
            <span class="hidden md:inline">Télécharger</span>
          </button>

          <!-- Bouton Partager -->
          <button 
            type="button" 
            id="headerSendBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #FFF; color: #a64182; border: 2px solid #2f2f2f;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">share</span>
            <span class="hidden sm:inline">Partager</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Conteneur pour formulaire et footer -->
    <div class="form-wrapper">
    <!-- Formulaire principal -->
    <div class="form-container">
      <!-- Titre de section -->
      <div id="sectionTitle" class="w-full max-w-6xl mb-4 md:mb-6">
        <div class="flex items-center gap-4">
          <div class="inline-block p-4 rounded-full progressive-glow-tertiary" style="background: #e062b1;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-12 w-12" style="color: #2f2f2f;" aria-hidden="true">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
          </div>
          <div>
            <h1 class="text-4xl font-bold text-white" style="font-size: 2.25rem !important; line-height: 2.5rem !important; font-weight: 700 !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">Génération de document</h1>
            <p class="mt-1" style="color: rgba(255, 255, 255, 0.8); font-size: 1rem; line-height: 1.5rem;">Créez vos documents professionnels en quelques clics.</p>
          </div>
        </div>
      </div>

      <!-- Barre d'action unique avec colonnes flexibles -->
      <div class="w-full max-w-6xl mb-4 md:mb-6">
        <div class="flex items-stretch gap-2 md:gap-3 min-w-0" style="max-width: 100%;">
          <!-- Colonne 1: Barre d'action principale (élastique) -->
          <div id="mainActionBar" class="bg-white border border-gray-200 p-2 md:p-4 flex items-center justify-between gap-2 md:gap-4 min-w-0" style="border-radius: 3rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32); flex: 1 1 auto;">
            <!-- Navigation par étapes -->
            <div class="flex items-center gap-1 md:gap-2 overflow-x-auto flex-1 relative tab-buttons-container min-w-0">
              <button type="button" class="tab-button-floating active px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="coordonnees">
                <span class="step-indicator-floating active w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                <span class="tab-label-floating hidden sm:inline">Coordonnées</span>
              </button>
              <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="contenu">
                <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                <span class="tab-label-floating hidden sm:inline">Contenu</span>
              </button>
              <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="expediteur">
                <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                <span class="tab-label-floating hidden sm:inline">Signataire</span>
              </button>
            </div>

            <!-- Navigation arrows - Tout à droite -->
            <div class="flex items-center gap-1 flex-shrink-0">
              <button type="button" id="actionPrevBtn" class="md3-button p-2 text-gray-700 elevation-1 flex items-center justify-center" style="border-radius: 2rem; min-width: 40px; display: none;">
                <span class="material-icons">arrow_back</span>
              </button>
              <button type="button" id="actionNextBtn" class="md3-button p-2 text-white elevation-1 flex items-center justify-center" style="background: #a84383; border-radius: 2rem; min-width: 40px;">
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
          </div>

          <!-- Colonne 2: Bouton personnaliser (conditionnel) -->
          <div class="bg-white border border-gray-200 p-2 md:p-4 flex items-center justify-center flex-shrink-0" id="customizeFieldsBtnContainer" style="border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32); display: none; width: auto;">
            <button type="button" id="customizeFieldsBtn" class="md3-button px-2 md:px-3 py-1.5 md:py-2 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap h-full" style="background: #3b5265; color: #ffffff !important; border-radius: 3.5rem;">
              <span class="material-icons text-base md:text-lg">build</span>
              <span class="hidden sm:inline">Personnaliser</span>
            </button>
          </div>

          <!-- Colonne 3: Bouton effacer tout -->
          <div class="bg-white border border-gray-200 p-2 md:p-4 flex items-center justify-center flex-shrink-0" style="border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32); width: auto;">
            <button type="button" id="clearAllDataBtn" class="flex items-center justify-center p-3 text-gray-600 hover:text-red-600 transition-colors hover:bg-red-50 rounded-full h-full" title="Effacer tout">
              <span class="material-icons" style="font-size: 28px;">delete_sweep</span>
            </button>
          </div>

          <!-- Colonne 4: Bouton données de test -->
          <div class="bg-white border border-gray-200 p-2 md:p-4 flex items-center justify-center flex-shrink-0" style="border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32); width: auto;">
            <button type="button" id="fillTestDataFloating" class="flex items-center justify-center p-3 text-gray-600 hover:text-blue-600 transition-colors hover:bg-blue-50 rounded-full h-full" title="Données de test">
              <span class="material-icons" style="font-size: 28px;">casino</span>
            </button>
          </div>
        </div>
      </div>

      <form id="docForm" class="bg-white md3-card w-full max-w-6xl space-y-8" style="padding: 1.5rem; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32);">

    <!-- Bouton données de test (caché, utilisé en interne) -->
    <button type="button" id="fillTestData" style="display: none;"></button>

    <!-- Sélecteur de template (caché, utilisé en interne) -->
    <select id="template" style="display: none;" required>
      <option value="">Choisir un type de document...</option>
    </select>

    <!-- Layout avec onglets à gauche et contenu à droite -->
    <div id="tabsContainer" class="flex flex-col md:flex-row gap-6" style="display: none;">
      <!-- Navigation par onglets (cachée, utilisée en interne) -->
      <div class="w-full md:w-64 flex-shrink-0" style="display: none;">
        <div class="tab-navigation md:sticky md:top-4 flex flex-row md:flex-col gap-2 overflow-x-auto md:overflow-x-visible">
          <button type="button" class="tab-button active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="coordonnees">
            <span class="step-indicator active w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">1</span>
            <span class="tab-button-text">Coordonnées</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="contenu">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">2</span>
            <span class="tab-button-text">Contenu</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="expediteur">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">3</span>
            <span class="tab-button-text">Signataire</span>
          </button>
        </div>
      </div>

      <!-- Contenu des onglets -->
      <div class="flex-1 min-w-0" id="dynamicFields">
        <!-- Section Coordonnées -->
        <div id="tab-coordonnees" class="tab-section active section-card">
          <!-- Nom du template sélectionné -->
          <div id="templateNameTitleCoordonnees" class="px-6 -mx-6 mb-2" style="display: none; margin-top: -2.5rem; padding-bottom: 1rem;">
            <h2 class="text-2xl font-bold text-gray-800" id="templateNameTextCoordonnees">-</h2>
          </div>
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 mb-6" style="background: linear-gradient(to right, #ffecf8, white);border-radius: 1rem;">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #2f2f2f;">
              <span class="material-icons" style="font-size: 28px; color: #e062b1;">person</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Coordonnées</h3>
              <p class="text-xs text-gray-600">Informations du destinataire</p>
            </div>
          </div>
          <div id="coordonneesFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Contenu -->
        <div id="tab-contenu" class="tab-section section-card">
          <!-- Nom du template sélectionné -->
          <div id="templateNameTitleContenu" class="px-6 -mx-6 mb-2" style="display: none; margin-top: -2.5rem; padding-bottom: 1rem;">
            <h2 class="text-2xl font-bold text-gray-800" id="templateNameTextContenu">-</h2>
          </div>
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 mb-6" style="background: linear-gradient(to right, #ffecf8, white);border-radius: 1rem;">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #181a1c;">
              <span class="material-icons" style="font-size: 28px; color: #e062b1;">article</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Contenu</h3>
              <p class="text-xs text-gray-600">Détails de la demande</p>
            </div>
          </div>
          <div id="contenuFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Signataire -->
        <div id="tab-expediteur" class="tab-section section-card">
          <!-- Nom du template sélectionné -->
          <div id="templateNameTitleExpediteur" class="px-6 -mx-6 mb-2" style="display: none; margin-top: -2.5rem; padding-bottom: 1rem;">
            <h2 class="text-2xl font-bold text-gray-800" id="templateNameTextExpediteur">-</h2>
          </div>
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 mb-6" style="background: linear-gradient(to right, #ffecf8, white);border-radius: 1rem;">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #181a1c;">
              <span class="material-icons" style="font-size: 28px; color: #e062b1;">send</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Signataire</h3>
              <p class="text-xs text-gray-600">Choix du Secrétaire Fédéral</p>
            </div>
          </div>
          <div id="expediteurFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
      </div>
    </div>

    <!-- Destinataires (caché, utilisé en interne via modal de partage) -->
    <div id="destinatairesSection" style="display: none;">
      <input id="destinataires" type="hidden">
    </div>

    <!-- Bouton d'action (caché, utilisé en interne) -->
    <button type="button" id="previewBtn" disabled style="display: none;"></button>

    <p id="message" class="text-center text-[#49454F] text-sm"></p>
    
    <!-- Stepper Navigation -->
    <div class="w-full max-w-6xl mt-6" style="display: none;">
      <div class="bg-white border border-gray-200 rounded-xl p-4 flex flex-col md:flex-row items-center justify-between gap-4" style="box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
        <!-- Stepper Progress -->
        <div class="flex items-center gap-2 md:gap-4 w-full md:w-auto justify-center" style="display: none;">
          <div class="flex items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-[#a84383] text-white">1</div>
            <div class="ml-2 hidden text-sm font-medium text-gray-700 md:hidden">Coordonnées</div>
          </div>
          <div class="h-px w-6 md:w-12 bg-gray-300"></div>
          <div class="flex items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600">2</div>
            <div class="ml-2 hidden text-sm font-medium text-gray-500 md:hidden">Contenu</div>
          </div>
          <div class="h-px w-6 md:w-12 bg-gray-300"></div>
          <div class="flex items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600">3</div>
            <div class="ml-2 hidden text-sm font-medium text-gray-500 md:hidden">Signataire</div>
          </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="flex items-center gap-3 w-full md:w-auto justify-end">
          <button type="button" id="prevStepBtn" class="md3-button px-4 py-2 text-gray-700 elevation-1 flex items-center gap-2 hidden" style="border-radius: 2rem; display: none;">
            <span class="material-icons">arrow_back</span>
            <span class="hidden sm:inline">Précédent</span>
          </button>
          <button type="button" id="nextStepBtn" class="md3-button px-4 py-2 text-white elevation-1 flex items-center gap-2" style="background: #a84383; border-radius: 2rem; display: none;">
            <span class="hidden sm:inline">Suivant</span>
            <span class="material-icons">arrow_forward</span>
          </button>
        </div>
      </div>
    </div>
    <!-- Bouton de prévisualisation (uniquement sur la dernière page) -->
    <div id="formActionButtons" class="flex justify-end gap-3 mt-6" style="display: none;">
      <button type="button" id="previewStepBtn" class="md3-button px-4 py-2 text-white elevation-1 flex items-center gap-2" style="background: #a84383; border-radius: 2rem;">
        <span class="material-icons">visibility</span>
        <span class="hidden sm:inline">Prévisualiser</span>
      </button>
    </div>
  </form>

  <!-- Modal de prévisualisation -->
  <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm p-4">
    <div class="bg-white md3-card elevation-3 w-full max-w-[95vw] h-[95vh] overflow-hidden relative flex flex-col" style="max-width: min(90vw, 860px);max-height: 150vw;">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons" style="color: #a13f7e; font-size: 42px; line-height: 1;">visibility</span>
          <div>
            <h2 class="text-2xl font-bold" style="color: #181a1c;">Prévisualisation du document</h2>
            <p class="text-sm" id="previewSubtitle" style="color: #181a1c;">Vérifiez les informations avant génération</p>
          </div>
        </div>
        <button id="closeModal" class="modal-close-button md3-button p-2 rounded-full state-layer state-layer-blue transition-all hover:scale-105 press-effect" style="background: white !important;">
          <span class="material-icons text-3xl" style="color: #36434e !important;">close</span>
        </button>
      </div>

      <!-- Contenu scrollable -->
      <div class="flex-1 overflow-hidden p-6">
        <div id="previewContent"></div>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center p-6 border-t border-gray-200 bg-gray-50" style="justify-content: flex-end;">
        <div class="flex gap-3">
          <button id="downloadWordBtn" class="md3-button px-6 py-2.5 text-white elevation-1 flex items-center gap-2 state-layer state-layer-blue transition-all hover:scale-105 press-effect" style="background: #dd60b0; border-radius: 2rem;">
            <span class="material-icons">download</span>
            <span class="hidden md:inline">Télécharger le document</span>
          </button>
          <button id="sendEmailBtn" class="md3-button px-6 py-2.5 elevation-2 flex items-center gap-2 state-layer state-layer-blue transition-all hover:scale-105 press-effect" style="background: #FFF; color: #a64182; border: 2px solid #2f2f2f; border-radius: 2rem;">
            <span class="material-icons">share</span>
            <span class="hidden md:inline">Partager</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour afficher le document Word -->
  <div id="wordViewerModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-[60] backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-7xl h-[95vh] overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal Word -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-[#0072ff]">
        <div class="flex items-center gap-3">
          <span class="material-icons text-white text-2xl">description</span>
          <div>
            <h2 class="text-xl font-bold text-white">Aperçu du document Word</h2>
            <p class="text-sm text-white opacity-90" id="wordViewerSubtitle">Génération en cours...</p>
          </div>
        </div>
        <button id="closeWordViewer" class="text-white md3-button p-2 rounded-full state-layer state-layer-blue transition-all hover:scale-105 press-effect">
          <span class="material-icons text-2xl">close</span>
        </button>
      </div>

      <!-- Contenu iframe -->
      <div class="flex-1 overflow-hidden relative bg-gray-100">
        <div id="wordViewerLoading" class="absolute inset-0 flex items-center justify-center bg-white z-10">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-[#0072ff] border-t-transparent mb-4"></div>
            <p class="text-[#49454F] text-lg font-medium">Génération du document Word...</p>
            <p class="text-[#49454F] text-sm mt-2">Cela peut prendre quelques secondes</p>
          </div>
        </div>
        <iframe id="wordViewerFrame" class="w-full h-full border-0" style="display:none;"></iframe>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-4 border-t border-gray-200 bg-gray-50">
        <div class="text-sm text-[#49454F] hidden md:block">
          <span class="material-icons text-base align-middle mr-1">info</span>
          Le document est généré par n8n et affiché via Google Docs Viewer
        </div>
        <div class="flex gap-3">
          <button id="closeWordViewerBtn" class="md3-button px-6 py-2.5 bg-gray-200 text-[#1C1B1F] elevation-1 flex items-center gap-2 state-layer state-layer-blue transition-all hover:scale-105 press-effect">
            <span class="material-icons">close</span>
            <span class="hidden md:inline">Fermer</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de partage (ajout de destinataires) -->
  <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-2xl overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons" style="color: #d557a6; font-size: 42px; line-height: 1;">share</span>
          <div>
            <h2 class="text-2xl font-bold" style="color: #181a1c;">Partager le document</h2>
            <p class="text-sm" style="color: #181a1c;">Ajoutez les destinataires pour l'envoi par email</p>
          </div>
        </div>
        <button id="closeShareModal" class="modal-close-button md3-button p-2 rounded-full state-layer state-layer-blue transition-all hover:scale-105 press-effect" style="background: white !important;">
          <span class="material-icons text-3xl" style="color: #36434e !important;">close</span>
        </button>
      </div>

      <!-- Contenu -->
      <div class="p-6 space-y-4">
        <!-- Destinataires -->
        <div>
          <label class="block text-base font-semibold mb-3" style="color: #181a1c;">
            Adresses email des destinataires <span style="color: #181a1c;">*</span>
          </label>
          <div id="shareEmailContainer" class="md3-input w-full p-3 bg-white flex flex-wrap gap-2 items-center min-h-[52px] cursor-text rounded-xl border-2 border-[#E8DEF8] focus-within:border-[#0072ff] transition-all">
            <input id="shareEmailInput" type="text" placeholder="Tapez une adresse email et appuyez sur virgule ou espace..." class="flex-1 outline-none min-w-[200px] text-base" style="color: #181a1c;">
          </div>
          <p class="text-sm mt-2 hidden md:block" style="color: #181a1c;">
            <span class="material-icons text-base align-middle mr-1">info</span>
            Séparez les adresses par des virgules, espaces ou point-virgules
          </p>
        </div>

        <!-- Message d'email -->
        <div>
          <label for="shareEmailMessage" class="block text-base font-semibold mb-3" style="color: #181a1c;">
            Message de l'email
          </label>
          <textarea
            id="shareEmailMessage"
            rows="6"
            class="w-full p-4 border-2 rounded-xl focus:outline-none transition-all resize-none focus:border-[#0072ff]"
            style="border-color: #E8DEF8; font-family: 'Roboto', sans-serif; color: #181a1c;"
            placeholder="Votre message ici..."
          ></textarea>
          <p class="text-sm mt-2 hidden md:block" style="color: #181a1c;">
            <span class="material-icons text-base align-middle mr-1">edit</span>
            Personnalisez le message qui accompagnera le document
          </p>
        </div>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50" style="justify-content: flex-end;">
        <button id="confirmShareBtn" class="md3-button px-6 py-2.5 elevation-2 flex items-center gap-2 state-layer state-layer-blue transition-all hover:scale-105 press-effect" style="background: #FFF; color: #a64182; border: 2px solid #2f2f2f; border-radius: 2rem;">
          <span class="material-icons">send</span>
          <span class="hidden md:inline">Générer et envoyer</span>
        </button>
      </div>
    </div>
  </div>
  </form>
  </div>

    <!-- Footer principal -->
    <footer class="main-footer">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10" style="padding-bottom: 1rem;">
        <div class="divider-gradient" style="margin-bottom: 1rem;"></div>
        <p class="text-xs text-white text-center" style="margin-top: 0;">Site réalisé par FO Métaux © <span id="currentYear">2025</span> FO Métaux. Tous droits réservés.Version <span id="appVersion">1.2.0</span></p>
      </div>
    </footer>
    </div>

    <!-- Panneau latéral des templates -->
    <aside class="templates-sidebar collapsed">
      <!-- Bouton toggle pour mobile -->
      <!-- Bouton toggle pour mobile - Affiche "Templates" uniquement en mobile -->
      <button type="button" class="templates-toggle-btn md:hidden" id="templatesToggleBtn" aria-label="Afficher/masquer les templates">
        <div class="flex items-center gap-1 md:gap-2">
          <span class="material-icons text-xl" style="color: #181a1c;">dashboard</span>
          <span class="text-base font-bold" style="color: #181a1c;">Templates</span>
        </div>
        <span class="material-icons text-xl">expand_more</span>
      </button>

      <!-- Contenu pliable -->
      <div class="templates-sidebar-content">
        <!-- Header du volet templates - Visible uniquement en desktop -->
        <div class="templates-sidebar-header mb-4 md:mb-6 pb-3 md:pb-4 border-b border-gray-200 hidden md:block">
          <h2 class="text-base md:text-2xl font-bold mb-0.5 md:mb-2 flex items-center gap-1 md:gap-2" style="color: #181a1c;">
            <span class="material-icons text-xl md:text-3xl" style="color: #181a1c;">dashboard</span>
            Templates
            <button type="button" class="templates-help-icon flex items-center justify-center rounded-full bg-transparent hover:bg-gray-200 transition-colors cursor-help ml-2" title="Sélectionnez un modèle de document" aria-label="Aide">
              <span class="material-icons" style="color: #a9a9a9; font-size: 18px;">help</span>
            </button>
          </h2>
        </div>

        <div id="templatesGallery">
          <!-- Les templates seront générés dynamiquement ici -->
        </div>
      </div>
    </aside>
  </div>

  <!-- Configuration des variables d'environnement (pour Netlify) -->
  <script>
    // Variables d'environnement - peuvent être surchargées par Netlify
    // En développement local, utilisez le proxy sur localhost:3000
    // En production (Netlify), ces valeurs seront remplacées par les variables d'environnement
    window.ENV = {
      WEBHOOK_URL: 'https://dee-wakeful-succulently.ngrok-free.dev/webhook/7f72ac69-35b7-4771-a5c6-7acb18947254',
      WEBHOOK_EMAIL_URL: 'https://dee-wakeful-succulently.ngrok-free.dev/webhook/1ee6e745-fc31-4fd8-bc59-531bd4a69997'
    };
    
    // Configuration de la version de l'application
    // Modifiez cette valeur pour mettre à jour la version dans tout le site
    window.APP_VERSION = '1.2.0';
  </script>

  <!-- JavaScript Modules -->
  <script type="module" src="assets/js/app.js?v=1.0.0"></script>
  
  <!-- Script pour mettre à jour l'année et la version automatiquement -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Mise à jour de l'année
      const yearElement = document.getElementById('currentYear');
      if (yearElement) {
        const currentYear = new Date().getFullYear();
        yearElement.textContent = currentYear;
      }
      
      // Mise à jour de la version
      const versionElement = document.getElementById('appVersion');
      if (versionElement && window.APP_VERSION) {
        versionElement.textContent = window.APP_VERSION;
      }
    });
  </script>

  <!-- Script pour le collapse des templates sur mobile -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggleBtn = document.getElementById('templatesToggleBtn');
      const sidebar = document.querySelector('.templates-sidebar');
      
      if (toggleBtn && sidebar) {
        // Fonction pour calculer la hauteur optimale du volet plié
        function calculateCollapsedHeight() {
          // Vérifier si on est sur mobile
          if (window.innerWidth >= 768) return;
          
          // Utiliser visualViewport si disponible (meilleur pour mobile avec barres d'adresse)
          const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
          
          // Obtenir la hauteur du header
          const header = document.querySelector('header');
          const headerHeight = header ? header.offsetHeight : 0;
          
          // Obtenir la hauteur du formulaire principal
          const formContainer = document.querySelector('.form-container');
          const formHeight = formContainer ? formContainer.offsetHeight : 0;
          
          // Calculer l'espace disponible pour le volet
          // On réserve un peu d'espace pour le padding et les marges
          const availableSpace = viewportHeight - headerHeight - formHeight;
          
          // Hauteur minimale pour le bouton toggle (environ 48px + padding)
          const minHeight = 60;
          
          // Hauteur maximale pour le volet plié (ne pas dépasser 20% de la fenêtre visible)
          const maxHeight = Math.min(availableSpace * 0.2, 80);
          
          // S'assurer que le volet ne dépasse jamais la hauteur visible
          const maxAllowedHeight = viewportHeight - headerHeight - 10; // 10px de marge
          const finalMaxHeight = Math.min(maxHeight, maxAllowedHeight);
          
          // Utiliser la hauteur calculée ou la hauteur minimale
          const calculatedHeight = Math.max(minHeight, finalMaxHeight);
          
          return calculatedHeight;
        }
        
        // Appliquer la hauteur calculée au volet plié
        function updateCollapsedHeight() {
          if (window.innerWidth < 768 && sidebar.classList.contains('collapsed')) {
            const height = calculateCollapsedHeight();
            sidebar.style.maxHeight = height + 'px';
          } else {
            sidebar.style.maxHeight = '';
          }
        }
        
        // Mettre à jour au chargement
        updateCollapsedHeight();
        
        // Mettre à jour la hauteur du form-container sur mobile
        function updateFormContainerHeight() {
          if (window.innerWidth < 768) {
            const header = document.querySelector('header');
            const formContainer = document.querySelector('.form-container');
            if (header && formContainer) {
              // Utiliser visualViewport si disponible
              const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
              const headerHeight = header.offsetHeight;
              const sidebarHeight = sidebar.classList.contains('collapsed') ? 60 : sidebar.offsetHeight;
              const availableHeight = viewportHeight - headerHeight - sidebarHeight;
              formContainer.style.height = availableHeight + 'px';
              formContainer.style.minHeight = availableHeight + 'px';
            }
          } else {
            const formContainer = document.querySelector('.form-container');
            if (formContainer) {
              formContainer.style.height = '';
              formContainer.style.minHeight = '';
            }
          }
        }
        
        // Mettre à jour au chargement
        updateFormContainerHeight();
        
        // Mettre à jour lors du redimensionnement et des changements de viewport
        let resizeTimeout;
        function handleViewportChange() {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(function() {
            updateCollapsedHeight();
            updateFormContainerHeight();
          }, 100);
        }
        window.addEventListener('resize', handleViewportChange);
        // Écouter les changements de visualViewport (important pour mobile avec barres d'adresse)
        if (window.visualViewport) {
          window.visualViewport.addEventListener('resize', handleViewportChange);
          window.visualViewport.addEventListener('scroll', handleViewportChange);
        }
        
        toggleBtn.addEventListener('click', function() {
          sidebar.classList.toggle('collapsed');
          
          // Mettre à jour la hauteur après le toggle
          setTimeout(function() {
            updateCollapsedHeight();
            updateFormContainerHeight();
          }, 50);
          
          // Mettre à jour l'aria-label
          const isCollapsed = sidebar.classList.contains('collapsed');
          toggleBtn.setAttribute('aria-label', isCollapsed 
            ? 'Afficher les templates' 
            : 'Masquer les templates');
          
          // La rotation de la flèche est gérée par CSS
        });
      }
    });
  </script>
  
  <!-- Script pour masquer le titre de section après 3s (mobile uniquement) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Activer uniquement sur mobile
      if (window.innerWidth < 768) {
        const sectionTitle = document.getElementById('sectionTitle');
        
        if (sectionTitle) {
          // Attendre 3 secondes puis masquer avec animation
          setTimeout(function() {
            // Ajouter les styles de transition plus fluides
            sectionTitle.style.transition = 'opacity 1s ease-in-out';
            sectionTitle.style.opacity = '0';
            
            // Appliquer display: none après l'animation (1s)
            setTimeout(function() {
              sectionTitle.style.display = 'none';
            }, 1000);
          }, 3000);
        }
      }
    });
  </script>
  
  <!-- Script pour l'animation de morphing entre les pages (mobile uniquement) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Activer l'animation uniquement sur mobile
      if (window.innerWidth < 768) {
        const tabButtons = document.querySelectorAll('.tab-button-floating');
        
        if (tabButtons.length > 0) {
          // Détecter les changements d'état actif
          tabButtons.forEach(button => {
            button.addEventListener('click', function() {
              // Ré-appliquer l'animation en forçant un reflow
              const indicator = this.querySelector('.step-indicator-floating');
              if (indicator && this.classList.contains('active')) {
                indicator.style.animation = 'none';
                setTimeout(() => {
                  indicator.style.animation = '';
                }, 10);
              }
            });
          });
        }
      }
    });
  </script>
  
  <!-- Script pour le swipe sur la barre d'action principale (mobile) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Activer le swipe uniquement sur mobile
      if (window.innerWidth < 768) {
        const mainActionBar = document.getElementById('mainActionBar');
        const actionNextBtn = document.getElementById('actionNextBtn');
        const actionPrevBtn = document.getElementById('actionPrevBtn');
        
        if (mainActionBar) {
          let touchStartX = 0;
          let touchEndX = 0;
          const minSwipeDistance = 50; // Distance minimale pour déclencher le swipe
          
          mainActionBar.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
          }, { passive: true });
          
          mainActionBar.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
          }, { passive: true });
          
          function handleSwipe() {
            const swipeDistance = touchEndX - touchStartX;
            
            // Swipe vers la droite (page précédente)
            if (swipeDistance > minSwipeDistance) {
              if (actionPrevBtn && actionPrevBtn.style.display !== 'none') {
                actionPrevBtn.click();
              }
            }
            // Swipe vers la gauche (page suivante)
            else if (swipeDistance < -minSwipeDistance) {
              if (actionNextBtn && actionNextBtn.style.display !== 'none') {
                actionNextBtn.click();
              }
            }
          }
        }
      }
    });
  </script>
</body>
</html>
