<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Génération de document</title>
  
  <!-- External Libraries -->
  <!-- Tailwind CSS compilé localement (pour éviter Tracking Prevention) -->
  <link rel="stylesheet" href="assets/css/tailwind.css?v=1.0.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Mammoth.js pour prévisualisation Word (local pour éviter Tracking Prevention) -->
  <script src="assets/js/lib/mammoth.browser.min.js"></script>

  <!-- SortableJS pour drag & drop (local pour éviter Tracking Prevention) -->
  <script src="assets/js/lib/Sortable.min.js"></script>

  <!-- Design System -->
  <link rel="stylesheet" href="assets/design-system/index.consolidated.css?v=1.0.0">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/base.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/animations.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/components.css?v=1.0.0">
  <link rel="stylesheet" href="assets/css/layout.css?v=1.0.0">
  <style>
    body {
      margin: 0 !important;
      padding: 0 !important;
      background: linear-gradient(135deg, #363e45 0%, #355976 100%) !important;
      background-size: 400% 400% !important;
      animation: gradient 15s ease infinite !important;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header {
      width: 100%;
      margin: 0;
      padding: 0;
      flex-shrink: 0;
    }
    .main-content {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
      }
    }
    .form-container {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    @media (min-width: 768px) {
      .form-container {
        padding: 2rem 3rem;
        max-width: 100%;
      }
    }
    @media (min-width: 1024px) {
      .form-container {
        padding: 3rem 4rem;
      }
    }
    @media (min-width: 1280px) {
      .form-container {
        padding: 3rem 5rem;
      }
    }
    .templates-sidebar {
      width: 100%;
      background: white;
      border-top: 1px solid #e5e7eb;
      overflow-y: hidden;
      overflow-x: hidden;
      padding: 0.75rem;
      flex-shrink: 0;
      box-shadow: 0 8px 32px #00000026, inset 0 0 0 1px #fff3, 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32);
      transition: max-height 300ms cubic-bezier(0.2, 0, 0, 1);
    }
    .templates-sidebar.collapsed {
      max-height: 60px;
    }
    .templates-sidebar:not(.collapsed) {
      max-height: 300px;
    }
    .templates-sidebar-content {
      transition: opacity 200ms ease, transform 200ms ease;
    }
    .templates-sidebar.collapsed .templates-sidebar-content {
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
      max-height: 0;
      overflow: hidden;
    }
    .templates-toggle-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 0.5rem 0;
      background: transparent;
      border: none;
      cursor: pointer;
      color: #1f2937;
      font-weight: 700;
      transition: color 200ms ease;
    }
    .templates-toggle-btn:hover {
      color: #2563eb;
    }
    .templates-toggle-btn .material-icons {
      transition: transform 300ms cubic-bezier(0.2, 0, 0, 1);
    }
    .templates-sidebar.collapsed .templates-toggle-btn .material-icons:last-child {
      transform: rotate(0deg);
    }
    .templates-sidebar:not(.collapsed) .templates-toggle-btn .material-icons:last-child {
      transform: rotate(180deg);
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        max-height: none !important;
      }
      .templates-sidebar.collapsed .templates-sidebar-content {
        opacity: 1;
        transform: none;
        pointer-events: auto;
        max-height: none;
        overflow: visible;
      }
      .templates-toggle-btn {
        display: none;
      }
      /* Header toujours visible en desktop */
      .templates-sidebar-header {
        display: block !important;
      }
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        width: 240px;
        border-top: none;
        border-left: 1px solid #e5e7eb;
        padding: 1.5rem 1rem;
        max-height: 100%;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        box-shadow: 0 8px 32px #00000026, inset 0 0 0 1px #fff3;
      }
    }
    .templates-sidebar::-webkit-scrollbar {
      width: 8px;
    }
    .templates-sidebar::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    .templates-sidebar::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    .templates-sidebar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    /* Carrousel mobile - Design Material Expressif façon Netflix */
    #templatesGallery {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      overflow-y: hidden;
      padding: 0.5rem 0.25rem;
      padding-bottom: 0.75rem;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(37, 99, 235, 0.3) transparent;
      scroll-behavior: smooth;
      scroll-snap-type: x proximity;
    }
    #templatesGallery::-webkit-scrollbar {
      height: 4px;
    }
    #templatesGallery::-webkit-scrollbar-track {
      background: transparent;
      border-radius: 2px;
    }
    #templatesGallery::-webkit-scrollbar-thumb {
      background: rgba(37, 99, 235, 0.3);
      border-radius: 2px;
      transition: background 0.3s ease;
    }
    #templatesGallery::-webkit-scrollbar-thumb:hover {
      background: rgba(37, 99, 235, 0.5);
    }
    .template-card {
      border: none;
      border-radius: 12px;
      padding: 0.25rem;
      cursor: pointer;
      transition: all 400ms cubic-bezier(0.2, 0, 0, 1);
      background: transparent;
      flex-shrink: 0;
      width: calc(33.333% - 0.33rem);
      min-width: 90px;
      scroll-snap-align: start;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @media (min-width: 768px) {
      #templatesGallery {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
        overflow-x: visible;
        overflow-y: visible;
        padding: 0;
        scroll-snap-type: none;
      }
      .template-card {
        width: 100%;
        padding: 0.75rem;
        flex-shrink: 1;
        min-width: auto;
      }
    }
    .template-thumbnail {
      width: 90px;
      height: 125px;
      border-radius: 8px;
      margin: 0 auto 0.25rem;
      object-fit: cover;
      transition: transform 400ms cubic-bezier(0.2, 0, 0, 1), 
                  box-shadow 400ms cubic-bezier(0.2, 0, 0, 1),
                  border-color 400ms cubic-bezier(0.2, 0, 0, 1);
      display: block;
      border: 2px solid transparent;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15),
                  0 2px 4px rgba(0, 0, 0, 0.1);
    }
    @media (min-width: 768px) {
      .template-thumbnail {
        width: 100%;
        height: 225px;
        border-radius: 3px;
      }
    }
    .template-card:hover .template-thumbnail {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4),
                  0 4px 8px rgba(37, 99, 235, 0.2);
      border-color: #60a5fa;
    }
    .template-card:active .template-thumbnail {
      transform: scale(1.05) translateY(-2px);
    }
    .template-card.selected .template-thumbnail {
      border-color: #1e3799;
      box-shadow: 0 0 0 2px #1e3799, 
                  0 8px 16px rgba(30, 55, 153, 0.3),
                  0 4px 8px rgba(30, 55, 153, 0.2);
      transform: translateY(-2px);
    }
    .template-card.selected .template-thumbnail .material-icons {
      color: white;
    }
    /* Texte sous les vignettes - Mobile */
    .template-card h3 {
      font-size: 0.7rem;
      line-height: 0.9rem;
      font-weight: 700;
      color: #1f2937;
      margin-top: 0.75rem;
      margin-bottom: 0.125rem;
      text-align: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      width: 100%;
    }
    .template-card p {
      display: none;
    }
    /* Texte sous les vignettes - Desktop */
    @media (min-width: 768px) {
      .template-card h3 {
        font-size: 1rem;
        line-height: 1.25rem;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        white-space: normal;
      }
      .template-card p {
        display: none;
      }
    }
    .tab-button-floating {
      background: transparent;
      color: #a9a9a9;
      border: none;
      cursor: pointer;
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }
    .tab-button-floating:hover {
      background: #f3f4f6;
    }
    .tab-button-floating.active {
      background: #e6f7da;
      color: #363e45;
    }
    .step-indicator-floating {
      background: #a9a9a9;
      color: white;
      transition: background-color var(--transition-fast), color var(--transition-fast);
    }
    .step-indicator-floating.active {
      background: #363e45;
      color: white;
    }
    #clearAllDataBtn:hover {
      background-color: #f8c29154 !important;
    }
    #headerPreviewBtn:disabled,
    #headerDownloadBtn:disabled {
      opacity: 0.5 !important;
      pointer-events: none;
    }
    #headerPreviewBtn:disabled:hover {
      transform: none !important;
      background-color: #4a69bd !important;
    }
    #headerDownloadBtn:disabled:hover {
      transform: none !important;
      background-color: #f6b93b !important;
    }
    /* Placeholders et icônes des champs de formulaire */
    input::placeholder,
    textarea::placeholder,
    select::placeholder {
      color: #a9a9a9 !important;
      opacity: 1;
    }
    .relative .material-icons.text-gray-400 {
      color: #a9a9a9 !important;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="glass-effect-strong border-b border-outlineVariant/50 sticky top-0 z-40 animate-slide-down backdrop-blur-xl">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16 sm:h-18">
        <!-- Logo et Titre -->
        <div class="flex items-center space-x-6 cursor-pointer transition-opacity hover:opacity-80">
          <div class="p-2 rounded-lg flex items-center justify-center h-10 w-10 elevation-2 progressive-glow-quinary transition-transform hover:scale-110" style="background: #079992;">
            <span class="material-icons text-white" style="font-size: 24px;">description</span>
          </div>
          <!-- Logo texte -->
          <div style="margin-left: 0.8rem;">
            <span class="text-xl font-bold whitespace-nowrap">
              <span style="color: #079992;">DocEasy</span>
              <span class="hidden sm:inline" style="color: #363e45;"> by FO Metaux</span>
            </span>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <!-- Bouton Prévisualiser -->
          <button 
            type="button" 
            id="headerPreviewBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium text-white elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #4a69bd;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">visibility</span>
            <span class="hidden sm:inline">Prévisualiser</span>
          </button>

          <!-- Bouton Télécharger -->
          <button 
            type="button" 
            id="headerDownloadBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium text-white elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #f6b93b;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">download</span>
            <span class="hidden md:inline">Télécharger</span>
          </button>

          <!-- Bouton Partager -->
          <button 
            type="button" 
            id="headerSendBtn" 
            disabled 
            class="flex items-center justify-center min-h-[44px] px-4 py-2 rounded-full text-sm font-medium text-white elevation-1 state-layer state-layer-blue disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105 press-effect gap-2"
            style="background: #38ada9;"
          >
            <span class="material-icons" style="font-size: 20px; line-height: 1;">share</span>
            <span class="hidden sm:inline">Partager</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Formulaire principal -->
    <div class="form-container">
      <!-- Titre de section -->
      <div class="w-full max-w-6xl mb-4 md:mb-6">
        <div class="flex items-center gap-4">
          <div class="inline-block p-4 rounded-full progressive-glow-tertiary" style="background: #b8e994;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-12 w-12" style="color: #363e45;" aria-hidden="true">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
          </div>
          <div>
            <h1 class="text-4xl font-bold text-white" style="font-size: 2.25rem !important; line-height: 2.5rem !important; font-weight: 700 !important; color: white !important; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">Génération de document</h1>
            <p class="mt-1" style="color: rgba(255, 255, 255, 0.8); font-size: 1rem; line-height: 1.5rem;">Créez vos documents professionnels en quelques clics.</p>
          </div>
        </div>
      </div>

      <!-- Barre d'action flottante -->
      <div class="w-full max-w-6xl mb-4 md:mb-6">
        <div class="bg-white border border-gray-200 p-2 md:p-4 flex items-center justify-between gap-2 md:gap-4 flex-wrap" style="border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32);">
          <!-- Navigation par étapes -->
          <div class="flex items-center gap-1 md:gap-2 overflow-x-auto flex-1">
            <button type="button" class="tab-button-floating active px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="coordonnees">
              <span class="step-indicator-floating active w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">1</span>
              <span class="hidden sm:inline">Coordonnées</span>
            </button>
            <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="contenu">
              <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">2</span>
              <span class="hidden sm:inline">Contenu</span>
            </button>
            <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium whitespace-nowrap" data-tab="expediteur">
              <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">3</span>
              <span class="hidden sm:inline">Signataire</span>
            </button>
          </div>

          <!-- Boutons d'action -->
          <div class="flex items-center gap-2">
            <button type="button" id="customizeFieldsBtn" class="md3-button px-3 md:px-4 py-1.5 md:py-2 bg-blue-50 text-blue-600 hover:bg-blue-100 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap" style="display: none;">
              <span class="material-icons text-base md:text-lg">build</span>
              <span class="hidden sm:inline">Personnaliser</span>
            </button>
            <button type="button" id="clearAllDataBtn" class="md3-button px-3 md:px-4 py-1.5 md:py-2 bg-red-50 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap" style="color: #eb2f06;">
              <span class="material-icons text-base md:text-lg">delete_sweep</span>
              <span class="hidden sm:inline">Effacer tout</span>
            </button>
            <button type="button" id="fillTestDataFloating" class="md3-button px-3 md:px-4 py-1.5 md:py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap">
              <span class="material-icons text-base md:text-lg">casino</span>
              <span class="hidden sm:inline">Données de test</span>
            </button>
          </div>
        </div>
      </div>

      <form id="docForm" class="bg-white md3-card w-full max-w-6xl space-y-8" style="padding: 1.5rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.52), 0 4px 6px -4px rgba(0, 0, 0, 0.32);">

    <!-- Bouton données de test (caché, utilisé en interne) -->
    <button type="button" id="fillTestData" style="display: none;"></button>

    <!-- Sélecteur de template (caché, utilisé en interne) -->
    <select id="template" style="display: none;" required>
      <option value="">Choisir un type de document...</option>
    </select>

    <!-- Layout avec onglets à gauche et contenu à droite -->
    <div id="tabsContainer" class="flex flex-col md:flex-row gap-6" style="display: none;">
      <!-- Navigation par onglets (cachée, utilisée en interne) -->
      <div class="w-full md:w-64 flex-shrink-0" style="display: none;">
        <div class="tab-navigation md:sticky md:top-4 flex flex-row md:flex-col gap-2 overflow-x-auto md:overflow-x-visible">
          <button type="button" class="tab-button active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="coordonnees">
            <span class="step-indicator active w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">1</span>
            <span class="tab-button-text">Coordonnées</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="contenu">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">2</span>
            <span class="tab-button-text">Contenu</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="expediteur">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">3</span>
            <span class="tab-button-text">Signataire</span>
          </button>
        </div>
      </div>

      <!-- Contenu des onglets -->
      <div class="flex-1 min-w-0" id="dynamicFields">
        <!-- Section Coordonnées -->
        <div id="tab-coordonnees" class="tab-section active section-card">
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 -mt-6 mb-6" style="background: linear-gradient(to right, #b8e9945c, white);">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #363e45;">
              <span class="material-icons" style="font-size: 28px; color: rgb(184, 233, 148);">person</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Coordonnées</h3>
              <p class="text-xs text-gray-600">Informations du destinataire</p>
            </div>
          </div>
          <div id="coordonneesFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Contenu -->
        <div id="tab-contenu" class="tab-section section-card">
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 -mt-6 mb-6" style="background: linear-gradient(to right, #b8e9945c, white);">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #363e45;">
              <span class="material-icons" style="font-size: 28px; color: rgb(184, 233, 148);">article</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Contenu</h3>
              <p class="text-xs text-gray-600">Détails de la demande</p>
            </div>
          </div>
          <div id="contenuFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Signataire -->
        <div id="tab-expediteur" class="tab-section section-card">
          <div class="flex items-center gap-4 px-6 py-4 border-b border-gray-200 -mx-6 -mt-6 mb-6" style="background: linear-gradient(to right, #b8e9945c, white);">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: #363e45;">
              <span class="material-icons" style="font-size: 28px; color: rgb(184, 233, 148);">send</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Signataire</h3>
              <p class="text-xs text-gray-600">Choix du Secrétaire Fédéral</p>
            </div>
          </div>
          <div id="expediteurFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
      </div>
    </div>

    <!-- Destinataires (caché, utilisé en interne via modal de partage) -->
    <div id="destinatairesSection" style="display: none;">
      <input id="destinataires" type="hidden">
    </div>

    <!-- Bouton d'action (caché, utilisé en interne) -->
    <button type="button" id="previewBtn" disabled style="display: none;"></button>

    <p id="message" class="text-center text-[#49454F] text-sm"></p>
  </form>

  <!-- Modal de prévisualisation -->
  <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-6xl max-h-[90vh] overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons" style="color: #4a69bd; font-size: 42px; line-height: 1;">visibility</span>
          <div>
            <h2 class="text-2xl font-bold" style="color: #363e45;">Prévisualisation du document</h2>
            <p class="text-sm" id="previewSubtitle" style="color: #363e45;">Vérifiez les informations avant génération</p>
          </div>
        </div>
        <button id="closeModal" class="text-[#49454F] hover:text-[#1C1B1F] transition-colors md3-button p-2 rounded-full hover:bg-gray-100">
          <span class="material-icons text-3xl">close</span>
        </button>
      </div>

      <!-- Contenu scrollable -->
      <div class="flex-1 overflow-auto p-6">
        <div id="previewContent"></div>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center p-6 border-t border-gray-200 bg-gray-50" style="justify-content: flex-end;">
        <div class="flex gap-3">
          <button id="downloadWordBtn" class="md3-button px-6 py-2.5 text-white elevation-1 flex items-center gap-2" style="background: #f6b93b;">
            <span class="material-icons">download</span>
            Télécharger le document
          </button>
          <button id="sendEmailBtn" class="md3-button px-6 py-2.5 text-white elevation-2 flex items-center gap-2" style="background: #38ada9;">
            <span class="material-icons">share</span>
            Partager
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour afficher le document Word -->
  <div id="wordViewerModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-[60] backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-7xl h-[95vh] overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal Word -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-[#0072ff]">
        <div class="flex items-center gap-3">
          <span class="material-icons text-white text-2xl">description</span>
          <div>
            <h2 class="text-xl font-bold text-white">Aperçu du document Word</h2>
            <p class="text-sm text-white opacity-90" id="wordViewerSubtitle">Génération en cours...</p>
          </div>
        </div>
        <button id="closeWordViewer" class="text-white hover:bg-white hover:bg-opacity-20 transition-colors md3-button p-2 rounded-full">
          <span class="material-icons text-2xl">close</span>
        </button>
      </div>

      <!-- Contenu iframe -->
      <div class="flex-1 overflow-hidden relative bg-gray-100">
        <div id="wordViewerLoading" class="absolute inset-0 flex items-center justify-center bg-white z-10">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-[#0072ff] border-t-transparent mb-4"></div>
            <p class="text-[#49454F] text-lg font-medium">Génération du document Word...</p>
            <p class="text-[#49454F] text-sm mt-2">Cela peut prendre quelques secondes</p>
          </div>
        </div>
        <iframe id="wordViewerFrame" class="w-full h-full border-0" style="display:none;"></iframe>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-4 border-t border-gray-200 bg-gray-50">
        <div class="text-sm text-[#49454F]">
          <span class="material-icons text-base align-middle mr-1">info</span>
          Le document est généré par n8n et affiché via Google Docs Viewer
        </div>
        <div class="flex gap-3">
          <button id="closeWordViewerBtn" class="md3-button px-6 py-2.5 bg-gray-200 text-[#1C1B1F] hover:bg-gray-300 elevation-1 flex items-center gap-2">
            <span class="material-icons">close</span>
            Fermer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de partage (ajout de destinataires) -->
  <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-2xl overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons" style="color: #38ada9; font-size: 42px; line-height: 1;">share</span>
          <div>
            <h2 class="text-2xl font-bold" style="color: #363e45;">Partager le document</h2>
            <p class="text-sm" style="color: #363e45;">Ajoutez les destinataires pour l'envoi par email</p>
          </div>
        </div>
        <button id="closeShareModal" class="transition-colors md3-button p-2 rounded-full hover:bg-gray-100" style="color: #363e45;">
          <span class="material-icons text-3xl">close</span>
        </button>
      </div>

      <!-- Contenu -->
      <div class="p-6 space-y-4">
        <!-- Destinataires -->
        <div>
          <label class="block text-base font-semibold mb-3" style="color: #363e45;">
            Adresses email des destinataires <span style="color: #363e45;">*</span>
          </label>
          <div id="shareEmailContainer" class="md3-input w-full p-3 bg-white flex flex-wrap gap-2 items-center min-h-[52px] cursor-text rounded-xl border-2 border-[#E8DEF8] focus-within:border-[#0072ff] transition-all">
            <input id="shareEmailInput" type="text" placeholder="Tapez une adresse email et appuyez sur virgule ou espace..." class="flex-1 outline-none min-w-[200px] text-base" style="color: #363e45;">
          </div>
          <p class="text-sm mt-2" style="color: #363e45;">
            <span class="material-icons text-base align-middle mr-1">info</span>
            Séparez les adresses par des virgules, espaces ou point-virgules
          </p>
        </div>

        <!-- Message d'email -->
        <div>
          <label for="shareEmailMessage" class="block text-base font-semibold mb-3" style="color: #363e45;">
            Message de l'email
          </label>
          <textarea
            id="shareEmailMessage"
            rows="6"
            class="w-full p-4 border-2 rounded-xl focus:outline-none transition-all resize-none focus:border-[#0072ff]"
            style="border-color: #E8DEF8; font-family: 'Roboto', sans-serif; color: #363e45;"
            placeholder="Votre message ici..."
          ></textarea>
          <p class="text-sm mt-2" style="color: #363e45;">
            <span class="material-icons text-base align-middle mr-1">edit</span>
            Personnalisez le message qui accompagnera le document
          </p>
        </div>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-6 border-t border-gray-200 bg-gray-50">
        <button id="closeShareModalBtn" class="md3-button px-6 py-2.5 bg-white border border-gray-300 hover:bg-gray-50 elevation-1 flex items-center gap-2 rounded-lg" style="color: #363e45;">
          <span class="material-icons">close</span>
          Annuler
        </button>
        <button id="confirmShareBtn" class="md3-button px-6 py-2.5 text-white elevation-2 flex items-center gap-2 rounded-lg" style="background: #38ada9;">
          <span class="material-icons">send</span>
          Générer et envoyer
        </button>
      </div>
    </div>
  </div>
  </form>
  </div>

    <!-- Panneau latéral des templates -->
    <aside class="templates-sidebar collapsed">
      <!-- Bouton toggle pour mobile -->
      <!-- Bouton toggle pour mobile - Affiche "Templates" uniquement en mobile -->
      <button type="button" class="templates-toggle-btn md:hidden" id="templatesToggleBtn" aria-label="Afficher/masquer les templates">
        <div class="flex items-center gap-1 md:gap-2">
          <span class="material-icons text-xl" style="color: #363e45;">dashboard</span>
          <span class="text-base font-bold" style="color: #363e45;">Templates</span>
        </div>
        <span class="material-icons text-xl">expand_more</span>
      </button>

      <!-- Contenu pliable -->
      <div class="templates-sidebar-content">
        <!-- Header du volet templates - Visible uniquement en desktop -->
        <div class="templates-sidebar-header mb-4 md:mb-6 pb-3 md:pb-4 border-b border-gray-200 hidden md:block">
          <h2 class="text-base md:text-2xl font-bold mb-0.5 md:mb-2 flex items-center gap-1 md:gap-2" style="color: #363e45;">
            <span class="material-icons text-xl md:text-3xl" style="color: #363e45;">dashboard</span>
            Templates
          </h2>
          <p class="text-xs md:text-sm text-gray-600 hidden md:block">Sélectionnez un modèle de document</p>
        </div>

        <div id="templatesGallery">
          <!-- Les templates seront générés dynamiquement ici -->
        </div>
      </div>
    </aside>
  </div>

  <!-- Configuration des variables d'environnement (pour Netlify) -->
  <script>
    // Variables d'environnement - peuvent être surchargées par Netlify
    window.ENV = {
      WEBHOOK_URL: 'https://dee-wakeful-succulently.ngrok-free.dev/webhook/7f72ac69-35b7-4771-a5c6-7acb18947254',
      WEBHOOK_EMAIL_URL: 'https://dee-wakeful-succulently.ngrok-free.dev/webhook/1ee6e745-fc31-4fd8-bc59-531bd4a69997'
    };
  </script>

  <!-- JavaScript Modules -->
  <script type="module" src="assets/js/app.js?v=1.0.0"></script>
  
  <!-- Script pour le collapse des templates sur mobile -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggleBtn = document.getElementById('templatesToggleBtn');
      const sidebar = document.querySelector('.templates-sidebar');
      
      if (toggleBtn && sidebar) {
        toggleBtn.addEventListener('click', function() {
          sidebar.classList.toggle('collapsed');
          
          // Mettre à jour l'aria-label
          const isCollapsed = sidebar.classList.contains('collapsed');
          toggleBtn.setAttribute('aria-label', isCollapsed 
            ? 'Afficher les templates' 
            : 'Masquer les templates');
          
          // La rotation de la flèche est gérée par CSS
        });
      }
    });
  </script>
</body>
</html>
