<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Génération de document</title>
  
  <!-- External Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/animations.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/layout.css">
  <style>
    body {
      margin: 0 !important;
      padding: 0 !important;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header {
      width: 100%;
      margin: 0;
      padding: 0;
      flex-shrink: 0;
    }
    .main-content {
      flex: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
      }
    }
    .form-container {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @media (min-width: 768px) {
      .form-container {
        padding: 2rem;
      }
    }
    .templates-sidebar {
      width: 100%;
      background: white;
      border-top: 1px solid #e5e7eb;
      overflow-y: auto;
      padding: 1rem;
      flex-shrink: 0;
      max-height: 300px;
    }
    @media (min-width: 768px) {
      .templates-sidebar {
        width: 240px;
        border-top: none;
        border-left: 1px solid #e5e7eb;
        padding: 1.5rem 1rem;
        max-height: 100%;
        height: 100%;
      }
    }
    .templates-sidebar::-webkit-scrollbar {
      width: 8px;
    }
    .templates-sidebar::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    .templates-sidebar::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    .templates-sidebar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    .template-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    @media (min-width: 768px) {
      .template-card {
        padding: 0.75rem;
      }
    }
    .template-card:hover {
      border-color: #2563eb;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
      transform: translateY(-2px);
    }
    .template-card.selected {
      border-color: #2563eb;
      background: #eff6ff;
      box-shadow: 0 4px 16px rgba(37, 99, 235, 0.25);
    }
    .template-thumbnail {
      width: 100%;
      height: 100px;
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
      overflow: hidden;
      position: relative;
    }
    @media (min-width: 768px) {
      .template-thumbnail {
        height: 160px;
      }
    }
    .template-thumbnail .material-icons {
      font-size: 40px;
      color: #9ca3af;
    }
    @media (min-width: 768px) {
      .template-thumbnail .material-icons {
        font-size: 56px;
      }
    }
    .template-card.selected .template-thumbnail {
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    }
    .template-card.selected .template-thumbnail .material-icons {
      color: white;
    }
    .tab-button-floating {
      background: transparent;
      color: #6b7280;
      border: none;
      cursor: pointer;
    }
    .tab-button-floating:hover {
      background: #f3f4f6;
    }
    .tab-button-floating.active {
      background: #eff6ff;
      color: #2563eb;
    }
    .step-indicator-floating {
      background: #e5e7eb;
      color: #6b7280;
    }
    .step-indicator-floating.active {
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      color: white;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="bg-white sticky top-0 z-50" style="border-bottom: 1px solid #f3f4f6; box-shadow: 0 8px 32px #00000026, inset 0 0 0 1px #fff3;">
    <div class="py-3 flex items-center justify-between gap-2 md:gap-4 px-4 md:px-8 lg:px-20">
      <div class="flex items-center gap-2 md:gap-3">
        <div class="inline-flex items-center justify-center w-8 h-8 md:w-10 md:h-10" style="background: #c4232d; border-radius: 8px;">
          <span class="text-white font-bold text-sm md:text-base">FO</span>
        </div>
        <div class="hidden sm:block">
          <h1 class="text-sm md:text-base font-semibold text-gray-900 leading-tight">
            Générateur de documents
          </h1>
          <p class="text-xs text-gray-500">by FO-Métaux</p>
        </div>
      </div>
      <div class="flex items-center gap-1 md:gap-2">
        <button type="button" id="headerPreviewBtn" disabled class="px-2 md:px-4 py-2 bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all" style="border-radius: 8px;">
          <span class="material-icons text-base md:text-lg">visibility</span>
          <span class="hidden sm:inline">Prévisualiser</span>
        </button>
        <button type="button" id="headerDownloadBtn" disabled class="px-2 md:px-4 py-2 bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all" style="border-radius: 8px;">
          <span class="material-icons text-base md:text-lg">download</span>
          <span class="hidden md:inline">Télécharger</span>
        </button>
        <button type="button" id="headerSendBtn" disabled class="px-2 md:px-4 py-2 text-white hover:bg-[#3b82f6] flex items-center gap-1 md:gap-2 font-medium text-xs md:text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all" style="background: #2563eb; border-radius: 8px;">
          <span class="material-icons text-base md:text-lg">share</span>
          <span class="hidden sm:inline">Partager</span>
        </button>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Formulaire principal -->
    <div class="form-container">
      <!-- Titre de section -->
      <div class="w-full max-w-5xl mb-4 md:mb-6">
        <div class="flex items-center gap-2 md:gap-3">
          <div class="inline-flex items-center justify-center w-12 h-12 md:w-16 md:h-16 elevation-2" style="background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); border-radius: 12px;">
            <span class="material-icons text-3xl md:text-4xl text-white">description</span>
          </div>
          <div>
            <h1 class="text-xl md:text-3xl font-bold" style="color: #ffffff;">
              Génération de document
            </h1>
            <p class="text-sm md:text-base" style="color: rgba(255, 255, 255, 0.8);">Créez vos documents professionnels en quelques clics</p>
          </div>
        </div>
      </div>

      <!-- Barre d'action flottante -->
      <div class="w-full max-w-5xl mb-4 md:mb-6">
        <div class="bg-white shadow-lg border border-gray-200 p-2 md:p-4 flex items-center justify-between gap-2 md:gap-4 flex-wrap" style="border-radius: 1rem;">
          <!-- Navigation par étapes -->
          <div class="flex items-center gap-1 md:gap-2 overflow-x-auto flex-1">
            <button type="button" class="tab-button-floating active px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium transition-all whitespace-nowrap" data-tab="coordonnees">
              <span class="step-indicator-floating active w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">1</span>
              <span class="hidden sm:inline">Coordonnées</span>
            </button>
            <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium transition-all whitespace-nowrap" data-tab="contenu">
              <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">2</span>
              <span class="hidden sm:inline">Contenu</span>
            </button>
            <button type="button" class="tab-button-floating px-2 md:px-4 py-1.5 md:py-2 rounded-lg flex items-center gap-1 md:gap-2 text-xs md:text-sm font-medium transition-all whitespace-nowrap" data-tab="expediteur">
              <span class="step-indicator-floating w-5 h-5 md:w-6 md:h-6 rounded-full flex items-center justify-center text-xs font-bold">3</span>
              <span class="hidden sm:inline">Signataire</span>
            </button>
          </div>

          <!-- Boutons d'action -->
          <div class="flex items-center gap-2">
            <button type="button" id="clearAllDataBtn" class="md3-button px-3 md:px-4 py-1.5 md:py-2 bg-red-50 text-red-600 hover:bg-red-100 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap">
              <span class="material-icons text-base md:text-lg">delete_sweep</span>
              <span class="hidden sm:inline">Effacer tout</span>
            </button>
            <button type="button" id="fillTestDataFloating" class="md3-button px-3 md:px-4 py-1.5 md:py-2 bg-gray-100 text-gray-700 hover:bg-gray-200 elevation-1 flex items-center gap-1 md:gap-2 rounded-lg font-semibold transition-all text-xs md:text-sm whitespace-nowrap">
              <span class="material-icons text-base md:text-lg">casino</span>
              <span class="hidden sm:inline">Données de test</span>
            </button>
          </div>
        </div>
      </div>

      <form id="docForm" class="bg-white md3-card elevation-3 w-full max-w-5xl space-y-8" style="padding: 1.5rem; border-radius: 1rem;">

    <!-- Bouton données de test (caché, utilisé en interne) -->
    <button type="button" id="fillTestData" style="display: none;"></button>

    <!-- Sélecteur de template (caché, utilisé en interne) -->
    <select id="template" style="display: none;" required>
      <option value="">Choisir un type de document...</option>
    </select>

    <!-- Layout avec onglets à gauche et contenu à droite -->
    <div id="tabsContainer" class="flex flex-col md:flex-row gap-6" style="display: none;">
      <!-- Navigation par onglets (cachée, utilisée en interne) -->
      <div class="w-full md:w-64 flex-shrink-0" style="display: none;">
        <div class="tab-navigation md:sticky md:top-4 flex flex-row md:flex-col gap-2 overflow-x-auto md:overflow-x-visible">
          <button type="button" class="tab-button active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="coordonnees">
            <span class="step-indicator active w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">1</span>
            <span class="tab-button-text">Coordonnées</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="contenu">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">2</span>
            <span class="tab-button-text">Contenu</span>
          </button>
          <button type="button" class="tab-button w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium text-[#49454F]" data-tab="expediteur">
            <span class="step-indicator w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-gray-200">3</span>
            <span class="tab-button-text">Signataire</span>
          </button>
        </div>
      </div>

      <!-- Contenu des onglets -->
      <div class="flex-1 min-w-0" id="dynamicFields">
        <!-- Section Coordonnées -->
        <div id="tab-coordonnees" class="tab-section active section-card">
          <div class="flex items-center gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-white border-b border-gray-200 -mx-6 -mt-6 mb-6">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);">
              <span class="material-icons text-white" style="font-size: 28px;">person</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Coordonnées</h3>
              <p class="text-xs text-gray-600">Informations du destinataire</p>
            </div>
          </div>
          <div id="coordonneesFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Contenu -->
        <div id="tab-contenu" class="tab-section section-card">
          <div class="flex items-center gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-white border-b border-gray-200 -mx-6 -mt-6 mb-6">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);">
              <span class="material-icons text-white" style="font-size: 28px;">article</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Contenu</h3>
              <p class="text-xs text-gray-600">Détails de la demande</p>
            </div>
          </div>
          <div id="contenuFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Section Signataire -->
        <div id="tab-expediteur" class="tab-section section-card">
          <div class="flex items-center gap-4 px-6 py-4 bg-gradient-to-r from-blue-50 to-white border-b border-gray-200 -mx-6 -mt-6 mb-6">
            <div class="w-14 h-14 rounded-full flex items-center justify-center flex-shrink-0" style="background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);">
              <span class="material-icons text-white" style="font-size: 28px;">send</span>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900">Signataire</h3>
              <p class="text-xs text-gray-600">Choix du Secrétaire Fédéral</p>
            </div>
          </div>
          <div id="expediteurFields" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
      </div>
    </div>

    <!-- Destinataires (caché, utilisé en interne via modal de partage) -->
    <div id="destinatairesSection" style="display: none;">
      <input id="destinataires" type="hidden">
    </div>

    <!-- Bouton d'action (caché, utilisé en interne) -->
    <button type="button" id="previewBtn" disabled style="display: none;"></button>

    <p id="message" class="text-center text-[#49454F] text-sm"></p>
  </form>

  <!-- Modal de prévisualisation -->
  <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-6xl max-h-[90vh] overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons text-[#0072ff] text-3xl">preview</span>
          <div>
            <h2 class="text-2xl font-bold text-[#1C1B1F]">Prévisualisation du document</h2>
            <p class="text-sm text-[#49454F]" id="previewSubtitle">Vérifiez les informations avant génération</p>
          </div>
        </div>
        <button id="closeModal" class="text-[#49454F] hover:text-[#1C1B1F] transition-colors md3-button p-2 rounded-full hover:bg-gray-100">
          <span class="material-icons text-3xl">close</span>
        </button>
      </div>

      <!-- Contenu scrollable -->
      <div class="flex-1 overflow-auto p-6">
        <div id="previewContent"></div>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-6 border-t border-gray-200 bg-gray-50">
        <button id="closeModalBtn" class="md3-button px-6 py-2.5 bg-gray-200 text-[#1C1B1F] hover:bg-gray-300 elevation-1 flex items-center gap-2">
          <span class="material-icons">close</span>
          Fermer
        </button>
        <div class="flex gap-3">
          <button id="downloadWordBtn" class="md3-button px-6 py-2.5 bg-[#E8DEF8] text-[#0072ff] hover:bg-[#D0BCFF] elevation-1 flex items-center gap-2">
            <span class="material-icons">download</span>
            Télécharger le document
          </button>
          <button id="sendEmailBtn" class="md3-button px-6 py-2.5 bg-[#0072ff] text-white hover:bg-[#0093ff] elevation-2 flex items-center gap-2">
            <span class="material-icons">send</span>
            Générer et envoyer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour afficher le document Word -->
  <div id="wordViewerModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-[60] backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-7xl h-[95vh] overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal Word -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-[#0072ff]">
        <div class="flex items-center gap-3">
          <span class="material-icons text-white text-2xl">description</span>
          <div>
            <h2 class="text-xl font-bold text-white">Aperçu du document Word</h2>
            <p class="text-sm text-white opacity-90" id="wordViewerSubtitle">Génération en cours...</p>
          </div>
        </div>
        <button id="closeWordViewer" class="text-white hover:bg-white hover:bg-opacity-20 transition-colors md3-button p-2 rounded-full">
          <span class="material-icons text-2xl">close</span>
        </button>
      </div>

      <!-- Contenu iframe -->
      <div class="flex-1 overflow-hidden relative bg-gray-100">
        <div id="wordViewerLoading" class="absolute inset-0 flex items-center justify-center bg-white z-10">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-[#0072ff] border-t-transparent mb-4"></div>
            <p class="text-[#49454F] text-lg font-medium">Génération du document Word...</p>
            <p class="text-[#49454F] text-sm mt-2">Cela peut prendre quelques secondes</p>
          </div>
        </div>
        <iframe id="wordViewerFrame" class="w-full h-full border-0" style="display:none;"></iframe>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-4 border-t border-gray-200 bg-gray-50">
        <div class="text-sm text-[#49454F]">
          <span class="material-icons text-base align-middle mr-1">info</span>
          Le document est généré par n8n et affiché via Google Docs Viewer
        </div>
        <div class="flex gap-3">
          <button id="closeWordViewerBtn" class="md3-button px-6 py-2.5 bg-gray-200 text-[#1C1B1F] hover:bg-gray-300 elevation-1 flex items-center gap-2">
            <span class="material-icons">close</span>
            Fermer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de partage (ajout de destinataires) -->
  <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 backdrop-blur-sm">
    <div class="bg-white md3-card elevation-3 w-full max-w-2xl overflow-hidden relative m-4 flex flex-col">
      <!-- Header du modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <span class="material-icons text-3xl" style="color: #2563eb;">share</span>
          <div>
            <h2 class="text-2xl font-bold text-gray-900">Partager le document</h2>
            <p class="text-sm text-gray-600">Ajoutez les destinataires pour l'envoi par email</p>
          </div>
        </div>
        <button id="closeShareModal" class="text-gray-600 hover:text-gray-900 transition-colors md3-button p-2 rounded-full hover:bg-gray-100">
          <span class="material-icons text-3xl">close</span>
        </button>
      </div>

      <!-- Contenu -->
      <div class="p-6">
        <label class="block text-base font-semibold text-gray-900 mb-3">
          Adresses email des destinataires <span style="color: #2563eb;">*</span>
        </label>
        <div class="relative">
          <span class="material-icons absolute left-3 top-3 text-gray-400 text-base pointer-events-none">email</span>
          <textarea id="shareEmailInput" class="w-full p-4 pl-10 border-2 rounded-xl focus:outline-none transition-all resize-none" style="border-color: #384151; border-radius: 0.375rem;" rows="4" placeholder="Entrez les emails séparés par des virgules&#10;Ex: contact@exemple.com, autre@exemple.com"></textarea>
        </div>
        <p class="text-sm text-gray-600 mt-2">
          <span class="material-icons text-base align-middle mr-1">info</span>
          Séparez les adresses par des virgules
        </p>
      </div>

      <!-- Footer avec actions -->
      <div class="flex items-center justify-between gap-3 p-6 border-t border-gray-200 bg-gray-50">
        <button id="closeShareModalBtn" class="md3-button px-6 py-2.5 bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 elevation-1 flex items-center gap-2 rounded-lg">
          <span class="material-icons">close</span>
          Annuler
        </button>
        <button id="confirmShareBtn" class="md3-button px-6 py-2.5 text-white hover:bg-[#3b82f6] elevation-2 flex items-center gap-2 rounded-lg" style="background: #2563eb;">
          <span class="material-icons">send</span>
          Générer et envoyer
        </button>
      </div>
    </div>
  </div>
  </form>
  </div>

    <!-- Panneau latéral des templates -->
    <aside class="templates-sidebar">
      <div class="mb-4 md:mb-6">
        <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-1 md:mb-2 flex items-center gap-2">
          <span class="material-icons text-2xl md:text-3xl" style="color: #2563eb;">dashboard</span>
          Templates
        </h2>
        <p class="text-xs md:text-sm text-gray-600">Sélectionnez un modèle de document</p>
      </div>

      <div id="templatesGallery" class="grid grid-cols-2 md:grid-cols-1 gap-2 md:gap-3">
        <!-- Les templates seront générés dynamiquement ici -->
      </div>
    </aside>
  </div>

  <!-- JavaScript Modules -->
  <script type="module" src="assets/js/app.js"></script>
</body>
</html>
